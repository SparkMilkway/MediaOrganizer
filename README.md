# 照片视频整理工具 (Photo & Video Organizer)

这是一个带有图形界面的照片和视频整理工具，可以帮助您自动整理和归档照片与视频文件。该工具特别适合处理从相机或手机导出的照片和视频，能够智能识别文件的创建时间，并按照年份和月份进行分类存储。

> 该工程所有代码和文件均由Cursor AI生成，主要使用的是Claude 3.5-sonnet

## 主要功能

1. **文件支持**
   - 图片格式：.jpg, .jpeg, .png, .heic, .heif
   - 视频格式：.mp4, .mov, .MOV

2. **智能时间识别**
   工具会通过以下方式依次尝试获取文件的创建时间：
   - 从照片的EXIF信息中读取原始拍摄时间
   - 通过相邻文件名推断创建时间（适用于连续拍摄的照片/视频）
   - 从文件路径中提取日期信息
   
3. **自动分类存储**
   - 按照"年份/月份"的目录结构自动整理文件
   - 自动设置正确的文件创建时间和修改时间
   - 对于无法确定时间的文件，保持原有的目录结构存放在"Unsorted"文件夹中

4. **图形界面功能**
   - 批量处理：自动整理照片和视频文件
   - 手动处理：手动设置文件的日期和时间
   - 相似照片查找：识别并管理重复或相似的照片
     - 支持调整相似度阈值
     - 支持动态调整缩略图大小
     - 支持批量选择和删除相似照片
     - 实时预览相似照片
   - 实时进度显示和详细日志
   - 响应式界面设计，支持窗口大小调整

## 使用要求

1. Python 3.6 或更高版本
2. 依赖包：
   ```
   Pillow==10.2.0
   piexif==1.1.3
   tqdm==4.66.2
   customtkinter==5.2.2
   tkcalendar==1.6.1
   PyQt6==6.6.1
   imagehash==4.3.1
   ```

## 安装方法

1. 克隆或下载本项目
2. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

## 使用方法

1. 运行程序：
   ```bash
   ./scripts/start_gui.sh
   ```

2. 在图形界面中：
   - **批量处理选项卡**：
     - 点击"浏览"选择输入目录（包含待处理的照片和视频的目录）
     - 点击"浏览"选择输出目录（可选，默认与输入目录相同）
     - 点击"开始处理"按钮开始整理
   - **手动处理选项卡**：
     - 点击"浏览文件"选择需要手动设置日期的照片/视频文件
     - 在日期输入框中设置您希望指定的拍摄日期和时间
     - 选择输出目录
     - 点击"处理选定的文件"按钮开始处理
   - **相似照片选项卡**：
     - 选择要搜索的目录
     - 调整相似度阈值（1-10，越小要求越相似）
     - 使用缩略图大小滑块调整预览图片大小（50-300像素）
     - 点击"开始搜索"按钮
     - 在预览区域查看相似照片：
       - 使用复选框选择要删除的照片
       - 使用"全选"和"取消全选"按钮快速选择
       - 点击"删除选中"按钮批量删除照片

3. 处理结果：
   - 已分类文件将存储在：`输出目录/年份/月份/` 下
   - 未能确定时间的文件将存储在：`输出目录/Unsorted/` 下，保持原有的目录结构

## 特点说明

1. **智能时间推断**
   - 优先使用照片的EXIF信息
   - 对于连续拍摄的照片/视频，通过文件名中的数字关联来推断时间
   - 支持从目录名中提取日期信息作为后备方案

2. **手动日期设置**
   - 对于无法自动识别日期的照片/视频，提供手动设置日期功能
   - 可以一次选择多个文件，批量设置为同一日期
   - 支持精确到年、月、日、时、分的时间设置

3. **相似照片管理**
   - 使用感知哈希算法识别相似照片
   - 支持调整相似度阈值，精确控制相似度要求
   - 提供缩略图预览，支持动态调整大小
   - 支持批量选择和删除操作
   - 实时显示处理进度和结果

4. **安全性考虑**
   - 保持原始文件不变
   - 对于无法处理的文件会保持原有的目录结构
   - 详细的日志记录所有操作
   - 删除操作需要确认

5. **用户友好**
   - 图形界面操作
   - 实时进度显示
   - 详细的处理日志
   - 清晰的错误提示
   - 支持批量操作
   - 响应式界面设计

## 注意事项

1. 建议在处理前备份重要文件
2. 程序会递归处理所选目录下的所有子目录
3. 对于重名文件，将保持原文件名移动到目标目录
4. 处理过程中请勿手动修改相关目录中的文件
5. 删除操作不可撤销，请谨慎操作

## 常见问题

1. **相似照片查找不准确**
   - 调整相似度阈值，较小的值要求更相似
   - 确保图片格式正确（支持jpg、jpeg、png）
   - 检查图片文件是否完整可读

2. **缩略图显示问题**
   - 使用缩略图大小滑块调整预览大小
   - 确保图片文件格式正确且可读
   - 检查图片文件权限是否正确

3. **批量删除不生效**
   - 确保已选择要删除的照片（复选框已勾选）
   - 确认删除操作（点击确认对话框）
   - 检查文件权限是否正确

## 开发者指南

1. **运行测试**
   ```bash
   ./scripts/run_tests.sh
   ```
   测试覆盖以下方面：
   - 核心功能单元测试
   - GUI集成测试
   - 代码覆盖率报告

2. **项目结构**
   ```
   .
   ├── src/
   │   ├── core/          # 核心处理逻辑
   │   ├── gui/           # 图形界面组件
   │   └── utils/         # 工具函数
   ├── tests/
   │   ├── unit/         # 单元测试
   │   └── integration/  # 集成测试
   ├── scripts/          # 脚本文件
   └── requirements.txt  # 项目依赖
   ```

3. **依赖管理**
   - GUI依赖：
     ```
     customtkinter>=5.2.2
     pillow>=10.2.0
     piexif>=1.1.3
     imagehash>=4.3.1
     tkcalendar>=1.6.1
     tqdm>=4.66.2
     ```
   - 测试依赖：
     ```
     pytest>=8.0.0
     pytest-cov>=4.1.0
     ``` 